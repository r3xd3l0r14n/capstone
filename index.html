<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Connect demo</title>
    <link rel="stylesheet" type="text/css" href="style.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-2.2.1.min.js"></script>
<script type="text/javascript">
    var ws;
    var playerName;
    var playerID;
    <!-- test check -->
    $().ready(function () {
        $("#btnConnect").click(function (){
            playerName = $("#playerName").val()
            $("#status").text("Connecting...");

            ws_url = "ws://" + location.host + "/connect"
            ws = new WebSocket(ws_url);
            ws.onopen = openHandler;
            ws.onmessage = messageHandler;
            ws.onerror = function(e) {
            $("#status").text(e.message);
            };
        });

        $("#btnJoin").click(function (){
            sendMessage(["join"]);
        })

    });

    function sendMessage(msgArray) {
        var msg = JSON.stringify(msgArray);
        ws.send(msg);
    }

    function openHandler(e){
        $("#status").text("connected to server");
        playerName = $('#playerName').val();

        sendMessage(["new_player", playerName]);

        $("#mainScreen").hide();
        $("#playScreen").show();

        $(document).bind("keydown", keyhandler);
    }

    function messageHandler(e){
        json = JSON.parse(e.data);
        if (!(json[0] instanceof Array))
            json = [json];

        for(var i =0; i < json.length; i++){
            var args = json[i];
            var cmd = json[i][0]
            switch(cmd){
                case("handshake"):
                    $("username").text(args[1]);
                    playerID = args[2];
                    break
                case("p_joined"):
                    var id = args[1];
                    var name = args[2];
                    addPlayer(id, name);



            }
        }
    }


    function addPlayer(id, name){
        $("#activePlayers").append('<div id="player' + id +'">'
                                    + '<div class="name">'+name+'</div>');
    }

</script>
</head>
<body>
<div id="status" style="text-align:left">&nbsp;</div>

<div>

<div id="mainScreen">
    <input id="playerName" type="text" maxlength="15"/>
    <button id="btnConnect">Connect</button>

    <p><b style="color: white">Go FISH!</b>in python because we can</p>
    <p>Currently only supports connecting thats it</p>
</div>

<div id="playScreen">
    <div id="activePlayers">ActivePlayers</div>
    <button id="btnJoin">!JOin</button>
</div>

</div>

</body>
</html>